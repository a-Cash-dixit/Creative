import Head from 'next/head'
import Message from '../components/Message'
import { db } from '../utils/firebase'
import react from 'react'
import { collection, doc, orderBy, query,onSnapshot } from 'firebase/firestore';
export default function Home() {
  const [allPosts,setallPosts]=react.useState([]);
  const getPosts=async()=>{
    const collectionRef=collection(db,'posts');
    const q=query(collectionRef,orderBy("timeStamp","desc"));
    const unsubscribe = onSnapshot(q, (snapshot) => {
      setallPosts(snapshot.docs.map((doc)=>({
        ...doc.data(),id:doc.id
      })));
  });
  }
  react.useEffect(()=>{
    getPosts();
  },[]);
  return (
    <div>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div>
        <h2>What's happening...</h2>
        {
          allPosts.map((post)=>{
            <Message {...post} />
          })
        }
      </div>
    </div>
  )
}
